<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <meta name="format-detection" content="telephone=no">
    <title>ふたマキ</title>
    <link rel="stylesheet" href="./css/style.css">
    <!-- <link rel="icon" href="favicon.ico"> -->
</head>
<body>
    <h1>ふたマキ</h1>
    <ul>
        <li class="checked" id="futamaki-release-link"><a href="https://install.appcenter.ms/users/azumyar/apps/futamaki/distribution_groups/release">ダウンロード</a></li>
        <li class="checked" id="futamaki-canary-link"><a href="https://install.appcenter.ms/users/azumyar/apps/futamaki/distribution_groups/canary/">カナリアビルド(人柱向け)</a></li>
        <li class="checked"><a href="https://github.com/azumyar/futaba-makimoki">ソースコード</a></li>
        <li class="checked"><a href="https://marshmallow-qa.com/yarukizero_dev">マシュマロ(連絡先)</a></li>
        <li class="checked"><a href="release-history.html">更新履歴</a></li>
        <li class="checked"><a href="marshmallow-history.html">返信履歴</a></li>
    </ul>

    <h2>なにこれ</h2>
    <p>
        某掲示板ブラウザです。<br />
        <a id="show-screenshot" onclick="showScreenshot()">スクリーンショット表示</a>
    </p>
    <div id="screenshot-section" style="display:none;">
        <div>
            <img src="img/ss01.jpg" loading="lazy" />
        </div>
        <div>
            <img src="img/ss02.jpg" loading="lazy" />
        </div>
        <div>
            <img src="img/ss03.jpg" loading="lazy" />
        </div>
        <div>
            <img src="img/ss04.jpg" loading="lazy" />
        </div>
        <div>
            <img src="img/ss05.jpg" loading="lazy" />
        </div>
        <div>
            <img src="img/ss06.jpg" loading="lazy" />
        </div>
    </div>

    <h2>動作環境</h2>
    <ul>
        <li class="checked">Windows 11/10/8.1(x64)</li>
        <li class="checked"><a href="https://aka.ms/vs/16/release/vc_redist.x64.exe">Visual Studio 2019 の Microsoft Visual C++ 再頒布可能パッケージ(x64)</a></li>
        <li class="checked"><a href="https://go.microsoft.com/fwlink/p/?LinkId=2124703">WebView2ランタイム</a>(はっちゃんキャンバス使用時のみ/Windows 11は標準でインストール済み)</li>
        <li class="checked"><a href="https://aka.ms/SegoeFluentIcons">Segoe Fluent Iconsフォント</a>(Windows 8.1のみ)</li>
    </ul>

    <h3>インストールについて</h3>
    <p>
        ダウンロードしたZIPを適当なディレクトリに展開してください。futamaki.exeが実行ファイルです。
    </p>

    <h3>アンインストールについて</h3>
    <p>
        ふたマキは標準で%userprofile%\Documents\FutaMakiと%appdata%\FutaMakiにファイルを生成します。アンインストール時はこれらのフォルダも削除してください。レジストリは使用していません。
    </p>

    <div id="task-section">
        <h2>リリースに向けて</h2>
        <h3>優先実装機能</h3>
        <ul>
            <li>スレ内検索を途中で放置しているのでちゃんと実装</li>
        </ul>

        <!--
        <h3>既知の問題点</h3>
        <ul>
        </ul>
        -->

        <h3>やれたらいいな</h3>
        <ul>
            <li>多重通信を行わないようにブロックしたほうがいいかな…</li>
            <li>起動時の画面をちゃんと整理したい</li>
            <li>トースト機能の強化</li>
            <li>カタログのソートとモードを保存</li>
        </ul>

        <!--
        <h3>やるきぜろ</h3>
        <ul>
            <li>手書き</li>
        </ul>
        -->

        <h3>Done</h3>
        <ul>
            <li class="checked">
                period.35 動画のサムネ実装
                <ul>
                    <li class="checked">投稿画面に動画のサムネを表示するように</li>
               </ul>
            </li>
            <li class="checked">
                period.34 見た目の修正
                <ul>
                    <li class="checked">Windows11の角丸スタイルに対応</li>
                    <li class="checked">コントロールのスタイルに独自スタイルを適用範囲を拡大</li>
                    <li class="checked">Cookie処理を修正</li>
                </ul>
            </li>
            <li class="checked">
                period.33 はっちゃんforタイムラプス対応
                <ul>
                    <li class="checked">はっちゃんforタイムラプス対応</li>
                    <li class="checked">カタログモードのモード切替を廃止</li>
                </ul>
            </li>
            <li class="checked">
                period.32 微調整
                <ul>
                    <li class="checked">imgのスレ保存設定が変わっていたので対応</li>
                    <li class="checked">消滅処理時間がローカル時刻を使っていた問題を修正</li>
                </ul>
            </li>
            <li class="checked">
                period.31 微調整
                <ul>
                    <li class="checked">スレが落ちているときに更新インタラクションを非表示に</li>
                    <li class="checked">カタログサムネツールチップにマウスイベントが奪われていた問題修正</li>
                </ul>
            </li>
        </ul>
    </div>

    <div id="backlog-section">
        <h2>バックログ</h2>
        <ul>
            <li>
                音声読み上げ
                <ul>
                    <li>WindowsのAPIでやる？</li>
                    <li>棒読みちゃん連携する？(棒読みちゃんはボイロ連携できる)</li>
                </ul>
            </li>
            <li>
                スレの自動更新関係
                <ul>
                    <li>パッシブ更新やったので次はアクティブ更新</li>
                </ul>
            </li>
            <li>ListBoxのホイールクリックでオートスクロールモードに(できるのか？)</li>
            <li>タスクバーを隠す設定にしてウィンドウを最大化するとタスクバーが出てこない(SourceTreeも出てこないしWindowChromeの問題？)</li>
            <li>カタログのタイトル文字数を設定できる機能</li>
            <li>開いたスレの履歴</li>
            <li>なーされたスレをキャッシュしている場合以前の書き込みを表示できる機能</li>
            <li>カタログのソートを1クリックでできるように</li>
            <li>
                カタログをレス増加数でソート
                <ul>
                    <li>現行のふたマキはふたばのカタログテーブルにマッピングしてるだけなのでどう対応するか要検討</li>
                </ul>
            </li>
            <li>スレ全画面から一発でカタログ全画面に遷移</li>
            <li>タブコントールタブの移動機能</li>
            <li>タブコントールタブのロック機能</li>
            <li>タブ限定でNG設定を無効化する</li>
        </ul>
    </div>

    <div id="qa-section">
        <h2>QA</h2>

        <h3>削除キーの平文保存</h3>
        <p>平文で保存しています。重要なパスワードを設定することはないとは思いますが、取り扱いには注意していください。イタチごっこになるため暗号化する予定はありません。</p>

        <h3>設定ファイル(など)の保存場所変更について</h3>
        <p>ポータブル化したい等の要望に対応するためふたマキは出力ファイル場所の制御が可能です。</p>
        <p>Conf.d\windows.exe.json.sampleをConf.d\windows.exe.jsonにリネームしてテキストエディタ(など)で編集します。UTF-8で保存してください。中身のJSONフォーマットが何かについてはここでは説明しません。</p>
        <table>
            <tr>
                <td>version</td>
                <td>固定値</td>
            </tr>
            <tr>
                <td>single-user-data</td>
                <td>true/false，trueにすると%appdata%配下ではなくexeファイル階層にSingleUserディレクトリを作りその配下にファイルを出力します</td>
            </tr>
            <tr>
                <td>single-user-config</td>
                <td>true/false，trueにすると%userprofile%\Documents配下ではなくexeファイル階層にSingleUserディレクトリを作りその配下にファイルを出力します</td>
            </tr>
            <tr>
                <td>custom-data-path</td>
                <td>ディレクトリパスを指定。%appdata%配下ではなく指定したパスにファイルを出力します。(single-user-dataがtrueの場合有効)</td>
            </tr>
            <tr>
                <td>custom-config-path</td>
                <td>ディレクトリパスを指定。%userprofile%\Documents配下ではなく指定したパスにファイルを出力します。(single-user-configがtrueの場合有効)</td>
            </tr>
        </table>

        <h3>ショートカットキー</h3>
        <p>メインウィンドウ</p>
        <table>
            <tr>
                <td>Ctrl+U</td>
                <td>スレッド更新</td>
            </tr>
            <tr style="display: none;">
                <td>Ctrl+F</td>
                <td>スレッド検索</td>
            </tr>
            <tr>
                <td>Ctrl+Enter</td>
                <td>レス投稿ビュー表示</td>
            </tr>
            <tr>
                <td>Ctrl+Alt+U</td>
                <td>カタログ更新</td>
            </tr>
            <tr style="display: none;">
                <td>Ctrl+Alt+F</td>
                <td>カタログ検索</td>
            </tr>
            <tr style="display: none;">
                <td>Ctrl+Alt+S</td>
                <td>カタログソートメニュー展開</td>
            </tr>

            <tr>
                <td>Ctrl+Alt+Enter</td>
                <td>新規スレッド投稿ビュー表示</td>
            </tr>
            <tr>
                <td>F5</td>
                <td>スレッド更新</td>
            </tr>

            <tr>
                <td>Ctrl+F5</td>
                <td>スレッド更新</td>
            </tr>
            <tr>
                <td>Ctrl+Alt+F5</td>
                <td>カタログ更新</td>
            </tr>
            <tr>
                <td>Ctrl+W</td>
                <td>今見ているスレッドを閉じる</td>
            </tr>

            <tr>
                <td>Ctrl+F4</td>
                <td>今見ているスレッドを閉じる</td>
            </tr>
        </table>

        <p>投稿ビュー</p>
        <table>
            <tr>
                <td>Ctrl+Enter</td>
                <td>スレッド作成/レス投稿</td>
            </tr>
            <tr>
                <td>Ctrl+P</td>
                <td>スレ/レス画像選択ダイアログ</td>
            </tr>

            <tr>
                <td>Ctrl+L</td>
                <td>あぷ小アップロード選択ダイアログ</td>
            </tr>
            <tr>
                <td>Ctrl+D</td>
                <td>今書いている内容を削除</td>
            </tr>
            <tr>
                <td>Ctr+Shift+V</td>
                <td>クリップボードのURL，画像データから投稿ビューに添付</td>
            </tr>

            <tr>
                <td>Esc</td>
                <td>閉じる</td>
            </tr>
        </table>
        <p>この設定は標準設定です。period.15より自由に設定ができるようになりました。</p>

        <h3>マウスジェスチャ</h3>
        <table>
            <tr>
                <td>↑←</td>
                <td>新規スレッド投稿ビュー表示</td>
            </tr>
            <tr>
                <td>↑↓</td>
                <td>カタログ更新</td>
            </tr>

            <tr>
                <td>↑→</td>
                <td>カタログ閉じる</td>
            </tr>
            <tr>
                <td>←↑←</td>
                <td>前のカタログタブに移動</td>
            </tr>
            <tr>
                <td>→↑→</td>
                <td>次のカタログタブに移動</td>
            </tr>

            <tr>
                <td>↓←</td>
                <td>レス投稿ビュー表示</td>
            </tr>
            <tr>
                <td>↓↑</td>
                <td>スレッド更新</td>
            </tr>

            <tr>
                <td>↓→</td>
                <td>今見ているスレッドを閉じる</td>
            </tr>
            <tr>
                <td>←↓←</td>
                <td>前のスレッドタブに移動</td>
            </tr>
            <tr>
                <td>→↓→</td>
                <td>次のスレッドタブに移動</td>
            </tr>
        </table>

        <h3>クリップボードからの投稿ビュー添付機能について</h3>
        <p>クリップボードに画像データが存在している場合JPEG形式で添付します。JPEGの圧縮品質は設定画面で編集可能です。</p>
        <p>クリップボードのテキストがURLかつサイズが3M以下かつMIMEタイプがサポート対象の場合ダウンロードして添付します。画像フォーマットの変更は行いません。</p>

        <h3>画像NG機能について注意</h3>
        <p>画像のNG判定はpHashでハッシュ化しハッシュ値の比較結果が閾値(閾値は設定画面で変更可能)をした回った場合類似画像としてNG処理を行います。これにより同じ画像を再圧縮した、サイズ変更したので見た目が同じでもファイルハッシュが違うケースにも対応可能ですが、pHashのハッシュ化処理はそこそこ重たいためNG画像を登録していない場合動作しないようになっています。NG画像を登録して動作が重たくなった場合PCがスペック不足の可能性があります。</p>

        <h3>ユーザ定義テーマの仕様について</h3>
        <p>現行β版です。そのうちまとめます。そのうち…今のところgitからテンプレ落としてきて編集して下さい…編集GUIは付ける予定ありません。</p>
    </div>

    <div id="contact-section">
        <h2>連絡先</h2>
        <ul>
            <li class="checked"><a href="https://marshmallow-qa.com/yarukizero_dev">マシュマロ</a></li>
        </ul>

        <h3>返信</h3>
        <p>
            <q>1点質問があります<br />
                内部的に各レスやカタログ等の情報をJSONに変換していますが、これらはどのようなエンドポイントを呼び出して取得しているのでしょうか<br />
            </q>
            スレのほうで返信しておいたのでっちーをご確認ください            
        </p>
    </div>

    <div id="contact-section">
        <h2>そのほかプロジェクト</h2>
        <ul>
            <li class="checked"><a href="https://github.com/azumyar/voicepeak-connect">VOICEPEAKの外部連携テスト(ゆかりねっと/棒読みちゃん)</a></li>
            <li class="checked"><a href="https://github.com/azumyar/yukarinette-voicevox">VOICEVOXとゆかりねっとの連携</a></li>
            <li class="checked"><a href="https://github.com/azumyar/sapi-voicevox">VOICEVOXと棒読みちゃんの連携</a></li>
        </ul>
    </div>
<script>
function showScreenshot() {
    document.getElementById("show-screenshot").style.display = "none";
    document.getElementById("screenshot-section").style.display = "flex";

}

// 最新版のリンクを張る
// IEは面倒見なくていいよね…
if(fetch && String.prototype.padStart) {
    fetch("https://dev.yarukizero.net/futamaki-version-v1.py")
        .then((response) => {
            return response.json();
        })
        .then((json) => {
            document.getElementById("futamaki-release-link").append("(最新:", json["release-app-center-version"], ")")
            document.getElementById("futamaki-canary-link").append("(最新:", json["canary-app-center-version"], ")")
        });
}

const el = document.getElementById("screenshot-section");
for(const div of el.getElementsByTagName("div")) {
    div.addEventListener("click", () => {
        if(div.classList.contains("orig")) {
            div.classList.remove("orig");
        } else {
            div.classList.add("orig");
        }
    });
}
</script>
</body>
</html>
